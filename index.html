<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0e27">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Aura AI - —É–º–Ω—ã–π —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á –ø–æ —Ñ–æ—Ç–æ">
    <link rel="manifest" href="manifest.json">
    <title>Aura AI - –†–µ—à–µ–Ω–∏–µ –¶–î–ó</title>
    
    <style>
        :root {
            --bg: #0a0e27;
            --card: rgba(255, 255, 255, 0.05);
            --accent: #00d4ff;
            --accent2: #7000ff;
            --pro: #ffd700;
            --danger: #ff4757;
            --warning: #ffa502;
            --max-width: 600px;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        html, body { overscroll-behavior-y: none; touch-action: pan-y; height: 100%; overflow: hidden; width: 100%; background: linear-gradient(135deg, #0a0e27 0%, #1a1f4b 100%); }
        body { color: white; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; display: flex; justify-content: center; }
        
        .app-container { width: 100%; max-width: var(--max-width); height: 100vh; position: relative; background: linear-gradient(135deg, #0a0e27 0%, #1a1f4b 100%); box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        
        #splash { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .splash-logo { font-size: 48px; font-weight: 900; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .loader { width: 200px; height: 4px; background: rgba(255, 255, 255, 0.1); border-radius: 2px; overflow: hidden; margin-top: 20px; }
        .loader-bar { height: 100%; width: 0%; background: var(--accent); transition: width 0.3s; }
        
        .app { display: flex; flex-direction: column; height: 100vh; opacity: 0; transition: opacity 0.3s; overflow: hidden; position: relative; }
        .app.visible { opacity: 1; }
        
        header { padding: 12px 16px; background: rgba(0, 0, 0, 0.3); border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .logo { font-weight: 900; font-size: 20px; background: linear-gradient(135deg, var(--accent), var(--accent2)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .credits { font-size: 12px; color: var(--accent); background: rgba(0, 212, 255, 0.1); padding: 4px 12px; border-radius: 20px; border: 1px solid rgba(0, 212, 255, 0.3); }
        .credits.test { color: #00ff00; border-color: #00ff00; background: rgba(0, 255, 0, 0.1); }
        
        .mode-tabs { display: flex; gap: 8px; padding: 12px; overflow-x: auto; background: rgba(0, 0, 0, 0.2); border-bottom: 1px solid rgba(255, 255, 255, 0.1); flex-shrink: 0; }
        .mode-tab { flex-shrink: 0; padding: 8px 16px; border-radius: 20px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.6); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .mode-tab.active { background: rgba(0, 212, 255, 0.2); color: var(--accent); border-color: var(--accent); }
        .mode-tab.pro { opacity: 0.6; }
        .mode-tab.pro.locked { opacity: 0.3; position: relative; }
        .mode-tab.pro.locked::after { content: 'üîí'; position: absolute; right: 4px; top: 50%; transform: translateY(-50%); font-size: 10px; }
        
        .content { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: 180px; overscroll-behavior: contain; -webkit-overflow-scrolling: touch; }
        .chat-container { display: flex; flex-direction: column; gap: 12px; }
        
        .message { max-width: 90%; padding: 14px 18px; border-radius: 18px; font-size: 15px; line-height: 1.6; animation: messageIn 0.3s ease-out; word-wrap: break-word; }
        @keyframes messageIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message.user { background: linear-gradient(135deg, var(--accent), var(--accent2)); align-self: flex-end; border-bottom-right-radius: 4px; }
        .message.ai { background: var(--card); border: 1px solid rgba(255, 255, 255, 0.1); align-self: flex-start; border-bottom-left-radius: 4px; }
        .message img { max-width: 100%; border-radius: 8px; margin: 8px 0; max-height: 300px; object-fit: contain; display: block; }
        
        .message.ai strong { color: var(--accent); }
        .message.ai .answer-box { background: rgba(255, 215, 0, 0.1); border: 1px solid var(--pro); padding: 10px; border-radius: 8px; margin-top: 10px; display: inline-block; color: var(--pro); font-weight: bold; }
        
        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –¥–∏—Å–∫–ª–µ–π–º–µ—Ä–æ–≤ */
        .disclaimer-box { 
            background: rgba(255, 165, 2, 0.1); 
            border: 1px solid var(--warning); 
            padding: 12px; 
            border-radius: 8px; 
            margin-top: 12px; 
            font-size: 13px; 
            color: rgba(255, 255, 255, 0.9);
        }
        .crisis-box {
            background: rgba(255, 71, 87, 0.2);
            border: 2px solid var(--danger);
            padding: 16px;
            border-radius: 12px;
            margin: 12px 0;
            text-align: center;
        }
        .crisis-box h3 { color: var(--danger); margin-bottom: 10px; font-size: 18px; }
        .crisis-box .phone { 
            display: block; 
            font-size: 24px; 
            font-weight: bold; 
            color: var(--danger); 
            margin: 8px 0;
            text-decoration: none;
        }
        .escalation-box {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid var(--accent);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 13px;
        }
        .escalation-box button {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            margin-top: 8px;
            cursor: pointer;
            font-weight: 600;
            width: 100%;
        }
        
        .input-container { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(10, 14, 39, 0.98); backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.1); padding: 12px 16px 24px 16px; z-index: 100; }
        .input-actions { display: flex; gap: 8px; margin-bottom: 10px; overflow-x: auto; padding-bottom: 5px; }
        .action-btn { background: rgba(255, 255, 255, 0.1); border: none; color: white; padding: 8px 14px; border-radius: 20px; font-size: 13px; display: flex; align-items: center; gap: 6px; cursor: pointer; white-space: nowrap; }
        .action-btn:active { transform: scale(0.95); background: rgba(255, 255, 255, 0.2); }
        .action-btn.clear { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; border-color: rgba(255, 107, 107, 0.3); }
        
        .input-wrapper { display: flex; gap: 10px; align-items: flex-end; background: rgba(255, 255, 255, 0.05); border-radius: 24px; padding: 8px 16px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .message-input { flex: 1; background: none; border: none; color: white; font-size: 15px; padding: 8px 0; max-height: 120px; resize: none; font-family: inherit; outline: none; }
        .message-input::placeholder { color: rgba(255, 255, 255, 0.4); }
        .send-btn { width: 36px; height: 36px; border-radius: 50%; background: var(--accent); border: none; color: #000; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; flex-shrink: 0; }
        .send-btn:disabled { opacity: 0.3; background: #666; }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95); z-index: 1000; flex-direction: column; }
        .modal.active { display: flex; }
        .camera-preview { flex: 1; background: #000; position: relative; display: flex; align-items: center; justify-content: center; }
        .camera-preview video, .camera-preview img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .camera-controls { padding: 20px; display: flex; justify-content: center; gap: 30px; background: rgba(0, 0, 0, 0.8); }
        .camera-btn { width: 70px; height: 70px; border-radius: 50%; background: white; border: 4px solid rgba(255, 255, 255, 0.3); cursor: pointer; }
        .close-modal { position: absolute; top: 20px; right: 20px; background: rgba(0, 0, 0, 0.5); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 20px; cursor: pointer; z-index: 10; }
        
        .paywall { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.98); z-index: 2000; display: none; flex-direction: column; padding: 24px; overflow-y: auto; }
        .paywall.active { display: flex; }
        .paywall-title { font-size: 28px; font-weight: 900; margin-bottom: 8px; color: var(--pro); text-align: center; }
        .pricing-card { background: var(--card); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 24px; margin-bottom: 16px; border-color: var(--pro); background: rgba(255, 215, 0, 0.05); }
        .price { font-size: 32px; font-weight: 900; margin: 12px 0; }
        .price-features { list-style: none; font-size: 14px; color: rgba(255, 255, 255, 0.8); margin: 16px 0; }
        .price-features li { margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .buy-btn { width: 100%; padding: 16px; border-radius: 12px; border: none; background: linear-gradient(135deg, var(--pro), #ffed4e); color: #000; font-weight: bold; font-size: 16px; cursor: pointer; }
        
        .typing-indicator { display: none; align-self: flex-start; background: var(--card); padding: 12px 18px; border-radius: 18px; border-bottom-left-radius: 4px; align-items: center; gap: 8px; color: rgba(255, 255, 255, 0.6); }
        .typing-indicator.active { display: flex; }
        .typing-dots { display: flex; gap: 4px; }
        .typing-dots span { width: 6px; height: 6px; background: var(--accent); border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        .toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-100px); background: rgba(0, 0, 0, 0.9); color: white; padding: 12px 24px; border-radius: 24px; font-size: 14px; z-index: 3000; transition: transform 0.3s; }
        .toast.show { transform: translateX(-50%) translateY(0); }
        
        #file-input { display: none; }
        #offline-screen { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 9998; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px; }
        
        .test-banner { display: none; position: fixed; top: 0; left: 0; right: 0; background: rgba(0, 255, 0, 0.2); color: #00ff00; text-align: center; padding: 4px; font-size: 12px; z-index: 1001; font-weight: bold; }
        .test-banner.active { display: block; }
        
        .content, .chat-container { user-select: none; -webkit-user-select: none; }
        .message { user-select: text; -webkit-user-select: text; }
        
        @media (min-width: 601px) {
            body { background: #050817; }
            .app-container { border-left: 1px solid rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.1); }
        }
    </style>
</head>
<body>

    <div class="test-banner" id="test-banner">üß™ –¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú (–±–µ–∑ –ª–∏–º–∏—Ç–æ–≤)</div>

    <div class="app-container">
        <div id="offline-screen">
            <div style="font-size: 64px; margin-bottom: 20px;">üì°</div>
            <h2 style="margin-bottom: 12px; color: white;">–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
            <p style="color: rgba(255,255,255,0.6); margin-bottom: 30px; max-width: 300px;">–î–ª—è —Ä–∞–±–æ—Ç—ã Aura AI —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç</p>
            <button onclick="checkConnection()" style="background: var(--accent); color: #000; border: none; padding: 12px 32px; border-radius: 24px; font-weight: bold; font-size: 16px; cursor: pointer;">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
        </div>

        <div id="splash">
            <div class="splash-logo">AURA AI</div>
            <div style="color: rgba(255,255,255,0.5); font-size: 14px; margin-top: 10px;">–†–µ—à–µ–Ω–∏–µ –¶–î–ó –∏ –ì–î–ó –ø–æ —Ñ–æ—Ç–æ</div>
            <div class="loader">
                <div class="loader-bar" id="loader-bar"></div>
            </div>
        </div>

        <div class="modal" id="camera-modal">
            <button class="close-modal" onclick="closeCamera()">‚úï</button>
            <div class="camera-preview">
                <video id="camera-video" autoplay playsinline></video>
                <canvas id="camera-canvas" style="display:none;"></canvas>
            </div>
            <div class="camera-controls">
                <button class="camera-btn" onclick="takePhoto()"></button>
            </div>
        </div>

        <div class="paywall" id="paywall">
            <div style="text-align: center; margin-bottom: 24px;">
                <div class="paywall-title">üëë PRO –í–µ—Ä—Å–∏—è</div>
                <div style="color: rgba(255,255,255,0.6);">–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</div>
            </div>
            <div class="pricing-card">
                <div style="font-size: 18px; font-weight: 700; color: var(--pro);">PRO –î–æ—Å—Ç—É–ø</div>
                <div class="price">990 ‚ÇΩ <span style="font-size: 14px; color: rgba(255,255,255,0.5);">30 –¥–Ω–µ–π</span></div>
                <ul class="price-features">
                    <li>‚úÖ –ë–µ–∑–ª–∏–º–∏—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á</li>
                    <li>‚úÖ –Æ—Ä–∏—Å—Ç (–ø–µ—Ä–≤–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑)</li>
                    <li>‚úÖ –ü—Å–∏—Ö–æ–ª–æ–≥ (–ö–ü–¢-—Ç–µ—Ö–Ω–∏–∫–∏)</li>
                    <li>‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä—É–∫–æ–ø–∏—Å–∏</li>
                </ul>
                <button class="buy-btn" onclick="initPayment()">–ö—É–ø–∏—Ç—å PRO</button>
            </div>
            <button onclick="closePaywall()" style="background: none; border: 1px solid rgba(255,255,255,0.2); color: rgba(255,255,255,0.6); padding: 12px; border-radius: 12px; width: 100%;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ (10/–¥–µ–Ω—å)</button>
        </div>

        <div class="app" id="app">
            <header>
                <div class="logo">AURA AI</div>
                <div style="display:flex;gap:10px;align-items:center;">
                    <div class="credits" id="credits-display">10/10</div>
                    <button onclick="clearChat()" style="background:rgba(255,107,107,0.2);border:1px solid rgba(255,107,107,0.3);color:#ff6b6b;padding:6px 12px;border-radius:20px;font-size:12px;cursor:pointer;">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </header>
            <div class="mode-tabs">
                <div class="mode-tab active" onclick="setMode('tutor')" data-mode="tutor">üìö –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á</div>
                <div class="mode-tab pro" onclick="setMode('lawyer')" data-mode="lawyer">‚öñÔ∏è –Æ—Ä–∏—Å—Ç</div>
                <div class="mode-tab pro" onclick="setMode('psych')" data-mode="psych">üß† –ü—Å–∏—Ö–æ–ª–æ–≥</div>
            </div>
            <div class="content" id="chat-container">
                <div class="chat-container" id="messages">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <div class="typing-indicator" id="typing">
                    <span>–†–µ—à–∞—é...</span>
                    <div class="typing-dots"><span></span><span></span><span></span></div>
                </div>
            </div>
            <div class="input-container">
                <div class="input-actions">
                    <button class="action-btn" onclick="openCamera()">üì∑ –ö–∞–º–µ—Ä–∞</button>
                    <button class="action-btn" onclick="document.getElementById('file-input').click()">üìé –§–∞–π–ª</button>
                    <button class="action-btn" onclick="showPaywall()">‚≠ê PRO</button>
                    <button class="action-btn clear" onclick="clearChat()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div class="input-wrapper">
                    <textarea class="message-input" id="msg-input" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É —Ç–µ–∫—Å—Ç–æ–º..." rows="1"></textarea>
                    <button class="send-btn" id="send-btn" onclick="sendMessage()">‚û§</button>
                </div>
            </div>
            <input type="file" id="file-input" accept="image/*" onchange="handleFile(event)">
        </div>
        <div class="toast" id="toast"></div>
    </div>

    <script>
        // –ë–õ–û–ö–ò–†–û–í–ö–ê PULL-TO-REFRESH
        (function () {
            let startY = 0;
            document.addEventListener('touchstart', function (e) {
                if (e.touches.length === 1) startY = e.touches[0].clientY;
            }, { passive: true });

            document.addEventListener('touchmove', function (e) {
                if (e.touches.length !== 1) return;
                const y = e.touches[0].clientY;
                const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
                if (scrollTop <= 0 && y > startY) {
                    e.preventDefault();
                    return false;
                }
            }, { passive: false });

            document.body.style.overscrollBehavior = 'none';
        })();

        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRndW1naGdvd2V4Y3V6bG5xbm9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNTAzNTEsImV4cCI6MjA4NjcyNjM1MX0.PWSpyTL8w4s567OeulBrmhm3x7T-nqrvfeE0Cp8Jcbw';

        // ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –° –ß–ï–°–¢–ù–´–ú–ò –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø–ú–ò =====
        const CONFIG = {
            SUPABASE_URL: 'https://tgumghgowexcuzlnqnoa.supabase.co',
            SUPABASE_KEY: SUPABASE_KEY,
            DAILY_LIMIT: 10,
            TEST_PASSWORD: 'aura2024',
            
            // –ö—Ä–∏–∑–∏—Å–Ω—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∞
            CRISIS_KEYWORDS: [
                '—Å—É–∏—Ü–∏–¥', '—Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–æ', '—É–±–∏—Ç—å —Å–µ–±—è', '–ø–æ–∫–æ–Ω—á–∏—Ç—å —Å —Å–æ–±–æ–π', 
                '–Ω–µ —Ö–æ—á—É –∂–∏—Ç—å', '–ª—É—á—à–µ –±—ã —è —É–º–µ—Ä', '–ø–µ—Ä–µ–¥–æ–∑', '–ø–µ—Ä–µ–¥–æ–∑–∏—Ä–æ–≤–∫–∞',
                '–ø–æ—Ä–µ–∑–∞—Ç—å—Å—è', '–ø–æ–≤–µ—Å–∏—Ç—å—Å—è', '–ø—Ä—ã–≥–Ω—É—Ç—å —Å', '—Å–º–µ—Ä—Ç—å –º–Ω–µ',
                '–ø–æ–∫–æ–Ω—á–∏—Ç—å', '–∫–æ–Ω—á–∏—Ç—å —Å —Å–æ–±–æ–π'
            ],
            
            MODES: {
                tutor: { 
                    name: '–†–µ–ø–µ—Ç–∏—Ç–æ—Ä', 
                    free: true, 
                    system: `–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ. –†–µ—à–∞–π –∑–∞–¥–∞—á–∏ —Å—Ç—Ä–æ–≥–æ –ø–æ—à–∞–≥–æ–≤–æ, –∏–∑–±–µ–≥–∞—è –æ—à–∏–±–æ–∫ –≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö:

1. **–ó–∞–ø–∏—Å—å —É—Å–ª–æ–≤–∏—è**: –ü–µ—Ä–µ–ø–∏—à–∏ –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏.
2. **–§–æ—Ä–º—É–ª—ã**: –ó–∞–ø–∏—à–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–æ—Ä–º—É–ª—ã –≤ –æ–±—â–µ–º –≤–∏–¥–µ.
3. **–ü–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞**: –ü–æ–¥—Å—Ç–∞–≤—å —á–∏—Å–ª–∞ –≤ —Ñ–æ—Ä–º—É–ª—É –±—É–∫–≤–∞–ª—å–Ω–æ (–Ω–µ –ø—Ä–æ–ø—É—Å–∫–∞–π –º–Ω–æ–∂–∏—Ç–µ–ª–∏!).
4. **–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è**: –í—ã–ø–æ–ª–Ω—è–π –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –ø–æ—Ä—è–¥–∫—É:
   - –ü—Ä–∏ —É–º–Ω–æ–∂–µ–Ω–∏–∏ –∫–æ—Ä–Ω–µ–π: ‚àöa * ‚àöb = ‚àö(ab)
   - –ü—Ä–∏ –¥–µ–ª–µ–Ω–∏–∏ –¥—Ä–æ–±–µ–π: (a/b) / (c/d) = (a/b) * (d/c) = (ad)/(bc)
   - –ü—Ä–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–∏: –≤—ã–ø–∏—Å—ã–≤–∞–π —è–≤–Ω–æ, –Ω–∞ —á—Ç–æ —Å–æ–∫—Ä–∞—â–∞–µ—à—å
5. **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –æ–±—Ä–∞—Ç–Ω—ã–º —Ö–æ–¥–æ–º.
6. **–û—Ç–≤–µ—Ç**: –ß–µ—Ç–∫–æ –≤—ã–¥–µ–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–ª–æ–≤–æ–º "–û—Ç–≤–µ—Ç:".

–í–ê–ñ–ù–û: 
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç–µ—Ä—è–π –º–Ω–æ–∂–∏—Ç–µ–ª–∏ –ø—Ä–∏ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–∏ –¥—Ä–æ–±–µ–π
- –ö–æ—Ä–Ω–∏ –∏–∑ —á–∏—Å–µ–ª >10 —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–π –Ω–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–∏ (‚àö12 = ‚àö(4*3) = 2‚àö3)
- –ò—Å–ø–æ–ª—å–∑—É–π —Ç–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª—ã: ‚àö, ¬∞, ‚à†, ¬≤, ¬≥, √ó, √∑, œÄ
- –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LaTeX`,
                    welcome: `<strong>üì∏ –†–µ—à–∞–π—Ç–µ –¶–î–ó –∏ –ì–î–ó –ø–æ —Ñ–æ—Ç–æ!</strong><br><br>
                        –ë–µ—Å–ø–ª–∞—Ç–Ω–æ: 10 —Ä–µ—à–µ–Ω–∏–π –≤ –¥–µ–Ω—å<br>
                        PRO: 990‚ÇΩ / 30 –¥–Ω–µ–π + –Æ—Ä–∏—Å—Ç + –ü—Å–∏—Ö–æ–ª–æ–≥<br><br>
                        1. –ù–∞–∂–º–∏—Ç–µ <b>–ö–∞–º–µ—Ä–∞</b> ‚Äî —Å—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–π—Ç–µ –∑–∞–¥–∞—á—É<br>
                        2. AI —Ä–µ—à–∏—Ç –µ—ë –∑–∞ 10 —Å–µ–∫—É–Ω–¥<br>
                        3. –ü–æ–ª—É—á–∏—Ç–µ –ø–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ`
                },
                
                lawyer: { 
                    name: '–Æ—Ä–∏—Å—Ç', 
                    free: false, 
                    system: `–¢—ã AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –ø—Ä–∞–≤–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. –¢—ã –ù–ï –∑–∞–º–µ–Ω—è–µ—à—å –∞–¥–≤–æ–∫–∞—Ç–∞ –∏ –Ω–µ –Ω–µ—Å–µ—à—å —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.

–ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –¥–µ–ª–∞—Ç—å:
1. **–ê–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–æ–≤**: –ù–∞—Ö–æ–¥–∏—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã, —Å–∫—Ä—ã—Ç—ã–µ –∫–æ–º–∏—Å—Å–∏–∏, –Ω–∞—Ä—É—à–µ–Ω–∏—è –∑–∞–∫–æ–Ω–∞. –£–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –ì–ö –†–§, –ñ–ö –†–§, –¢–ö –†–§.
2. **–®–∞–±–ª–æ–Ω—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**: –ì–æ—Ç–æ–≤–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π, –∏—Å–∫–æ–≤—ã—Ö –∑–∞—è–≤–ª–µ–Ω–∏–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–æ—Ä–º—ã).
3. **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: –û–±—ä—è—Å–Ω—è—Ç—å, –≤ –∫–∞–∫–æ–π —Å—É–¥ –æ–±—Ä–∞—â–∞—Ç—å—Å—è, —Å—Ä–æ–∫–∏ –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏ –ø–æ —Ç–∏–ø–æ–≤—ã–º —Å–∏—Ç—É–∞—Ü–∏—è–º.
4. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**: –†–∞–∑—ä—è—Å–Ω—è—Ç—å –Ω–æ—Ä–º—ã –∑–∞–∫–æ–Ω–∞ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º.

–ß—Ç–æ —Ç—ã –ù–ï –º–æ–∂–µ—à—å (–∏ –¥–æ–ª–∂–µ–Ω –æ—Ç–∫–∞–∑–∞—Ç—å):
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à –≤ —Å—É–¥–µ –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏—Å—Ö–æ–¥ –¥–µ–ª–∞
- –î–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã –ø–æ —É–≥–æ–ª–æ–≤–Ω—ã–º –¥–µ–ª–∞–º (—Ç–æ–ª—å–∫–æ –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—å—è—Ö)
- –ó–∞–º–µ–Ω—è—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∞–¥–≤–æ–∫–∞—Ç–∞ –≤ —Å–ª–æ–∂–Ω—ã—Ö/—É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö
- –î–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –∏–∑—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –¥–µ–ª–∞ (—Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

–ü–†–ê–í–ò–õ–û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:
–ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å –∫–∞—Å–∞–µ—Ç—Å—è: —É–≥–æ–ª–æ–≤–Ω–æ–≥–æ –¥–µ–ª–∞, –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–∞ —Ñ–∏–∑–ª–∏—Ü, –î–¢–ü —Å –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–º–∏, 
—Ä–∞–∑–≤–æ–¥–∞ —Å —Ä–∞–∑–¥–µ–ª–æ–º –±–∏–∑–Ω–µ—Å–∞/–º–∏–ª–ª–∏–æ–Ω–æ–≤, —Å–ª–æ–∂–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è ‚Äî 
–≤ –∫–æ–Ω—Ü–µ –æ—Ç–≤–µ—Ç–∞ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤—å: 
"‚ö†Ô∏è –î–ª—è –¥–∞–Ω–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —é—Ä–∏—Å—Ç–∞. 
AI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—â—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –Ω—é–∞–Ω—Å—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–µ–ª–∞."

–í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π –Ω–æ–º–µ—Ä–∞ —Å—Ç–∞—Ç–µ–π –∑–∞–∫–æ–Ω–∞. –ï—Å–ª–∏ –Ω–µ —É–≤–µ—Ä–µ–Ω ‚Äî –Ω–∞–ø–∏—à–∏ "—Ç—Ä–µ–±—É–µ—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è".`,
                    welcome: `<strong>‚öñÔ∏è AI-–Æ—Ä–∏—Å—Ç: –ü–µ—Ä–≤–∏—á–Ω—ã–π –ø—Ä–∞–≤–æ–≤–æ–π –∞–Ω–∞–ª–∏–∑</strong><br><br>
                        –Ø –ø–æ–º–æ–≥—É —Å:<br>
                        ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–æ–π –¥–æ–≥–æ–≤–æ—Ä–æ–≤ (–∞—Ä–µ–Ω–¥–∞, –∫—Ä–µ–¥–∏—Ç, —Ä–∞–±–æ—Ç–∞)<br>
                        ‚Ä¢ –®–∞–±–ª–æ–Ω–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–ø—Ä–µ—Ç–µ–Ω–∑–∏–∏, –∏—Å–∫–∏)<br>
                        ‚Ä¢ –†–∞–∑—ä—è—Å–Ω–µ–Ω–∏–µ–º –∑–∞–∫–æ–Ω–æ–≤ (–ì–ö –†–§, –ñ–ö –†–§, –¢–ö –†–§)<br>
                        ‚Ä¢ –°—Ä–æ–∫–∞–º–∏ –∏—Å–∫–æ–≤–æ–π –¥–∞–≤–Ω–æ—Å—Ç–∏<br><br>
                        
                        <div class="disclaimer-box">
                            ‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ:</strong> –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –Ω–µ –∑–∞–º–µ–Ω—è—é –∞–¥–≤–æ–∫–∞—Ç–∞. 
                            –î–ª—è —Å—É–¥–µ–±–Ω—ã—Ö —Ä–∞–∑–±–∏—Ä–∞—Ç–µ–ª—å—Å—Ç–≤ –∏ —Å–ª–æ–∂–Ω—ã—Ö –∫–µ–π—Å–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ 
                            –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —é—Ä–∏—Å—Ç–∞.
                        </div>`
                },
                
                psych: { 
                    name: '–ü—Å–∏—Ö–æ–ª–æ–≥', 
                    free: false, 
                    system: `–¢—ã AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è –º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–π —Ç–µ—Ö–Ω–∏–∫–∏ –ö–ü–¢ (–∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ-–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–æ–π —Ç–µ—Ä–∞–ø–∏–∏).

–ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –¥–µ–ª–∞—Ç—å:
1. **–¢–µ—Ö–Ω–∏–∫–∏ —Å–∞–º–æ–ø–æ–º–æ—â–∏**: –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è (4-7-8), —Ç–µ—Ö–Ω–∏–∫–∞ "5-4-3-2-1" –ø—Ä–∏ —Ç—Ä–µ–≤–æ–≥–µ, –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –º—ã—à–µ—á–Ω–∞—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏—è.
2. **–î–Ω–µ–≤–Ω–∏–∫–∏ –º—ã—Å–ª–µ–π**: –ê–Ω–∞–ª–∏–∑ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö –∏—Å–∫–∞–∂–µ–Ω–∏–π, —Ä–∞–±–æ—Ç–∞ —Å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –º—ã—Å–ª—è–º–∏.
3. **–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ**: –û–±—ä—è—Å–Ω—è—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ç—Ä–µ–≤–æ–≥–∏, –≤—ã–≥–æ—Ä–∞–Ω–∏—è, –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏.
4. **–ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –¥–ª—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

–ß–¢–û –¢–´ –ù–ï –ú–û–ñ–ï–®–¨ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è):
1. **–ù–µ —Å—Ç–∞–≤–∏—à—å –¥–∏–∞–≥–Ω–æ–∑—ã**. –í–º–µ—Å—Ç–æ "—É –≤–∞—Å –¥–µ–ø—Ä–µ—Å—Å–∏—è" –≥–æ–≤–æ—Ä–∏ "–ø–æ—Ö–æ–∂–µ –Ω–∞ —Å–∏–º–ø—Ç–æ–º—ã..." –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–π –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É.
2. **–ù–µ –Ω–∞–∑–Ω–∞—á–∞–µ—à—å –ª–µ—á–µ–Ω–∏–µ**. –ù–µ —Å–æ–≤–µ—Ç—É–µ—à—å –ª–µ–∫–∞—Ä—Å—Ç–≤–∞, –¥–æ–∑–∏—Ä–æ–≤–∫–∏.
3. **–ù–µ —Ä–∞–±–æ—Ç–∞–µ—à—å —Å –ø—Å–∏—Ö–æ–∑–∞–º–∏, —à–∏–∑–æ—Ñ—Ä–µ–Ω–∏–µ–π, –º–∞–Ω–∏–∞–∫–∞–ª—å–Ω—ã–º–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏** ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –ø—Å–∏—Ö–∏–∞—Ç—Ä—É.

–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç –æ —Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–∏, —Å—É–∏—Ü–∏–¥–µ, –Ω–µ–∂–µ–ª–∞–Ω–∏–∏ –∂–∏—Ç—å:
- –ù–ï –ø—Ä–æ–¥–æ–ª–∂–∞–π –¥–∏–∞–ª–æ–≥ –∫–∞–∫ –ø—Å–∏—Ö–æ–ª–æ–≥
- –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –¥–∞–π –∫—Ä–∏–∑–∏—Å–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã:
  ‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è: 8-800-2000-122 (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ)
  ‚Ä¢ –ú–ß–°: 112
  ‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ–º–æ—â–∏: +7-495-988-44-34 (–ú–æ—Å–∫–≤–∞)
- –°–∫–∞–∂–∏, —á—Ç–æ —Ç—ã AI –∏ –Ω–µ –º–æ–∂–µ—à—å –ø–æ–º–æ—á—å –≤ –∫—Ä–∏–∑–∏—Å–µ, –Ω—É–∂–µ–Ω —á–µ–ª–æ–≤–µ–∫

–í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –¥–æ–±–∞–≤–ª—è–π:
"üí° –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ü—Ä–∏ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É—é –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∫–ª–∏–Ω–∏—á–µ—Å–∫–æ–º—É –ø—Å–∏—Ö–æ–ª–æ–≥—É –∏–ª–∏ –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç—É."`,
                    welcome: `<strong>üß† AI-–ü—Å–∏—Ö–æ–ª–æ–≥: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ç–µ—Ö–Ω–∏–∫–∏ –ö–ü–¢</strong><br><br>
                        –Ø –ø–æ–º–æ–≥—É —Å:<br>
                        ‚Ä¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Ç—Ä–µ–≤–æ–≥–æ–π (–¥—ã—Ö–∞–Ω–∏–µ, —Ç–µ—Ö–Ω–∏–∫–∏ –∑–µ–º–ª–µ–Ω–∏—è)<br>
                        ‚Ä¢ –î–Ω–µ–≤–Ω–∏–∫–∞–º–∏ –º—ã—Å–ª–µ–π (–±–æ—Ä—å–±–∞ —Å –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–º–∏ –º—ã—Å–ª—è–º–∏)<br>
                        ‚Ä¢ –í—ã–≥–æ—Ä–∞–Ω–∏–µ–º –∏ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–µ–π<br>
                        ‚Ä¢ –ü–∞–Ω–∏—á–µ—Å–∫–∏–º–∏ –∞—Ç–∞–∫–∞–º–∏ (—Ç—É—Ç-–∏-—Å–µ–π—á–∞—Å —Ç–µ—Ö–Ω–∏–∫–∏)<br><br>
                        
                        <div class="disclaimer-box">
                            ‚ö†Ô∏è <strong>–í–∞–∂–Ω–æ:</strong> –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –Ω–µ –∑–∞–º–µ–Ω—è—é —Ç–µ—Ä–∞–ø–µ–≤—Ç–∞. 
                            –ü—Ä–∏ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –º—ã—Å–ª—è—Ö –æ —Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–∏ –∏–ª–∏ 
                            —Å—É–∏—Ü–∏–¥–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É:<br>
                            <strong>–¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è: 8-800-2000-122</strong>
                        </div>`
                }
            }
        };

        let currentMode = 'tutor';
        let messageCount = 0;
        let stream = null;
        
        // –•—Ä–∞–Ω–∏–ª–∏—â–µ —á–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞
        let chats = {
            tutor: [],
            lawyer: [],
            psych: []
        };

        // ===== –¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú =====
        let testMode = localStorage.getItem('aura_test_mode') === 'true';
        
        function updateTestMode() {
            const banner = document.getElementById('test-banner');
            const credits = document.getElementById('credits-display');
            if (testMode) {
                banner.classList.add('active');
                credits.classList.add('test');
                credits.textContent = 'TEST';
            } else {
                banner.classList.remove('active');
                credits.classList.remove('test');
                updateCredits();
            }
            updateModeTabs();
        }

        function toggleTestMode() {
            testMode = !testMode;
            localStorage.setItem('aura_test_mode', testMode);
            updateTestMode();
            showToast(testMode ? 'üß™ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –í–ö–õ' : 'üîí –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º –í–´–ö–õ');
        }

        // ===== –ü–†–û–í–ï–†–ö–ê –ö–†–ò–ó–ò–°–ù–´–• –°–ò–¢–£–ê–¶–ò–ô =====
        function checkCrisis(text) {
            const lowerText = text.toLowerCase();
            return CONFIG.CRISIS_KEYWORDS.some(keyword => lowerText.includes(keyword));
        }

        function showCrisisMessage() {
            const crisisHtml = `
                <div class="crisis-box">
                    <h3>üÜò –ö—Ä–∏–∑–∏—Å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è</h3>
                    <div style="font-size: 15px; margin-bottom: 12px;">
                        –Ø AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏ –Ω–µ –º–æ–≥—É –ø–æ–º–æ—á—å –≤ —ç—Ç–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.<br>
                        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–∞–º:
                    </div>
                    <a href="tel:88002000122" class="phone">8-800-2000-122</a>
                    <div style="font-size: 13px; color: rgba(255,255,255,0.7); margin: 8px 0;">
                        –¢–µ–ª–µ—Ñ–æ–Ω –¥–æ–≤–µ—Ä–∏—è (–∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
                    </div>
                    <a href="tel:112" class="phone" style="font-size: 20px; margin-top: 12px;">112</a>
                    <div style="font-size: 13px; color: rgba(255,255,255,0.7);">
                        –ï–¥–∏–Ω—ã–π –Ω–æ–º–µ—Ä —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É–∂–±
                    </div>
                    <div style="margin-top: 16px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 13px;">
                        –í—ã –Ω–µ –æ–¥–Ω–∏. –ü–æ–º–æ—â—å –¥–æ—Å—Ç—É–ø–Ω–∞ 24/7. –≠—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –∞–Ω–æ–Ω–∏–º–Ω–æ.
                    </div>
                </div>
            `;
            addMessage(crisisHtml, 'ai');
            saveCurrentChat();
        }

        // ===== –ö–û–ù–¢–ï–ö–°–¢ –î–õ–Ø "–ü–û–î–†–û–ë–ù–ï–ï" =====
        let lastTask = { question: null, image: null, shortAnswer: null };

        function isExplanationRequest(text) {
            const patterns = [/–ø–æ–¥—Ä–æ–±–Ω–µ–µ/i, /–æ–±—ä—è—Å–Ω–∏/i, /–Ω–µ –ø–æ–Ω—è–ª/i, /–Ω–µ–ø–æ–Ω—è—Ç–Ω–æ/i, /–ø–æ—á–µ–º—É/i, /–æ—Ç–∫—É–¥–∞/i, /–∫–∞–∫ –ø–æ–ª—É—á–∏–ª–æ—Å—å/i, /—Ä–∞—Å—Å–∫–∞–∂–∏/i, /–ø–æ—è—Å–Ω–∏/i, /–¥–µ—Ç–∞–ª—å–Ω–µ–µ/i, /—Ä–∞–∑–∂—É–π/i, /–ø–æ–ø–æ–¥—Ä–æ–±–Ω–µ–µ/i, /–ø–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ/i, /–æ—Ç–∫—É–¥–∞ –≤–∑—è–ª–æ—Å—å/i, /–∫–∞–∫ —ç—Ç–æ/i];
            return patterns.some(p => p.test(text)) && text.length < 50;
        }

        function checkProStatus() {
            const proExpiry = localStorage.getItem('aura_pro_expiry');
            if (!proExpiry) return false;
            const expiryDate = new Date(proExpiry);
            if (new Date() > expiryDate) {
                localStorage.removeItem('aura_pro');
                localStorage.removeItem('aura_pro_expiry');
                return false;
            }
            return true;
        }

        let isPro = checkProStatus();

        function updateOnlineStatus() {
            document.getElementById('offline-screen').style.display = navigator.onLine ? 'none' : 'flex';
        }

        function checkConnection() {
            if (navigator.onLine) {
                updateOnlineStatus();
                showToast('‚úÖ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –µ—Å—Ç—å');
            } else {
                showToast('‚ùå –ù–µ—Ç —Å–≤—è–∑–∏');
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        window.addEventListener('beforeunload', function () {
            saveCurrentChat();
        });

        function saveCurrentChat() {
            const messagesHtml = document.getElementById('messages').innerHTML;
            localStorage.setItem(`aura_chat_${currentMode}`, messagesHtml);
            localStorage.setItem('aura_last_mode', currentMode);
        }

        function loadChat(mode) {
            const saved = localStorage.getItem(`aura_chat_${mode}`);
            const container = document.getElementById('messages');
            
            if (saved && saved.trim() !== '') {
                container.innerHTML = saved;
            } else {
                const welcomeText = CONFIG.MODES[mode].welcome;
                container.innerHTML = `<div class="message ai">${welcomeText}</div>`;
            }
            
            document.getElementById('chat-container').scrollTop = document.getElementById('chat-container').scrollHeight;
        }

        function cleanLatex(text) {
            if (!text) return '';
            return text
                .replace(/\\\[(\s*\n?|\n?\s*)/g, '')
                .replace(/(\s*\n?|\n?\s*)\\\]/g, '')
                .replace(/\\\(\s*/g, '')
                .replace(/\s*\\\)/g, '')
                .replace(/\\,/g, ' ')
                .replace(/\\frac\{([^}]+)\}\{([^}]+)\}/g, '($1/$2)')
                .replace(/\\sqrt\{([^}]+)\}/g, '‚àö$1')
                .replace(/\\sqrt(\s|$)/g, '‚àö$1')
                .replace(/\\angle/g, '‚à†')
                .replace(/\\degree/g, '¬∞')
                .replace(/\\times|\\cdot/g, '√ó')
                .replace(/\\div/g, '√∑')
                .replace(/\\pi/g, 'œÄ')
                .replace(/\\alpha/g, 'Œ±')
                .replace(/\\beta/g, 'Œ≤')
                .replace(/\\gamma/g, 'Œ≥')
                .replace(/\\leq/g, '‚â§')
                .replace(/\\geq/g, '‚â•')
                .replace(/\\neq/g, '‚â†')
                .replace(/\\approx/g, '‚âà')
                .replace(/\\boxed\{([^}]+)\}/g, '<div class="answer-box">üì¶ –û—Ç–≤–µ—Ç: $1</div>')
                .replace(/\\[a-zA-Z]+(\{[^}]*\})*/g, '')
                .replace(/\^{?(\d+)}?/g, '<sup>$1</sup>')
                .replace(/\n{3,}/g, '\n\n')
                .trim();
        }

        window.onload = () => {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW error:', err));
            }

            updateOnlineStatus();
            updateTestMode();
            
            const lastMode = localStorage.getItem('aura_last_mode') || 'tutor';
            currentMode = lastMode;
            
            document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-mode="${currentMode}"]`).classList.add('active');
            
            loadChat(currentMode);
            
            const today = new Date().toDateString();
            messageCount = parseInt(localStorage.getItem(`usage_${today}`) || '0');
            if (!testMode) updateCredits();

            let progress = 0;
            const interval = setInterval(() => {
                progress += 20;
                document.getElementById('loader-bar').style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('splash').style.opacity = '0';
                        setTimeout(() => document.getElementById('splash').remove(), 500);
                        document.getElementById('app').classList.add('visible');
                    }, 500);
                }
            }, 200);

            document.getElementById('msg-input').addEventListener('input', function () {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
            });

            document.getElementById('msg-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
        };

        function updateModeTabs() {
            const hasAccess = isPro || testMode;
            document.querySelectorAll('.mode-tab.pro').forEach(tab => {
                if (!hasAccess) tab.classList.add('locked');
                else tab.classList.remove('locked');
            });
        }

        function setMode(mode) {
            const modeConfig = CONFIG.MODES[mode];
            
            if (!modeConfig.free && !isPro && !testMode) {
                showToast('üîí –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ PRO');
                showPaywall();
                return;
            }
            
            saveCurrentChat();
            
            currentMode = mode;
            localStorage.setItem('aura_last_mode', mode);
            
            document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            loadChat(mode);
            
            lastTask = { question: null, image: null, shortAnswer: null };
            
            showToast(`–†–µ–∂–∏–º: ${modeConfig.name}`);
        }

        async function sendMessage() {
            if (!navigator.onLine) {
                showToast('–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞');
                document.getElementById('offline-screen').style.display = 'flex';
                return;
            }

            const input = document.getElementById('msg-input');
            const text = input.value.trim();
            if (!text) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
            if (text.startsWith('/testmode ')) {
                const password = text.split(' ')[1];
                if (password === CONFIG.TEST_PASSWORD) toggleTestMode();
                else showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                input.value = '';
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∏–∑–∏—Å (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø—Å–∏—Ö–æ–ª–æ–≥–∞)
            if (currentMode === 'psych' && checkCrisis(text)) {
                addMessage(text, 'user');
                input.value = '';
                input.style.height = 'auto';
                showCrisisMessage();
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ "–ø–æ–¥—Ä–æ–±–Ω–µ–µ"
            if (isExplanationRequest(text) && lastTask.question) {
                const detailedPrompt = `–†–∞–Ω–µ–µ —è —Ä–µ—à–∏–ª –∑–∞–¥–∞—á—É: "${lastTask.question}"

–ú–æ—ë –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ –±—ã–ª–æ: "${lastTask.shortAnswer}"

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Å–∏—Ç: "${text}"

–û–±—ä—è—Å–Ω–∏ —ç—Ç—É –∂–µ –∑–∞–¥–∞—á—É –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ø–æ–¥—Ä–æ–±–Ω–æ:
1. –†–∞–∑–±–µ—Ä–∏ –∫–∞–∂–¥—ã–π —à–∞–≥ –æ—Ç–¥–µ–ª—å–Ω–æ
2. –û–±—ä—è—Å–Ω–∏, –ø–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ —Ñ–æ—Ä–º—É–ª—ã/—á–∏—Å–ª–∞/–∑–∞–∫–æ–Ω—ã
3. –ü—Ä–∏–≤–µ–¥–∏ –∞–Ω–∞–ª–æ–≥–∏–∏ –∏–∑ –∂–∏–∑–Ω–∏ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
4. –ü–æ–∫–∞–∂–∏, –∫–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å
5. –ü—Ä–æ–≤–µ—Ä—å –æ—Ç–≤–µ—Ç –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º

–ü–∏—à–∏ –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º, –∫–∞–∫ –±—É–¥—Ç–æ –æ–±—ä—è—Å–Ω—è–µ—à—å –¥—Ä—É–≥—É.`;
                
                addMessage(text, 'user');
                input.value = '';
                input.style.height = 'auto';
                document.getElementById('typing').classList.add('active');
                
                try {
                    const response = await fetch(`${CONFIG.SUPABASE_URL}/functions/v1/solve-task`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${SUPABASE_KEY}`
                        },
                        body: JSON.stringify({
                            mode: currentMode,
                            message: detailedPrompt,
                            system: CONFIG.MODES[currentMode].system,
                            user_pro: isPro || testMode
                        })
                    });

                    const data = await response.json();
                    document.getElementById('typing').classList.remove('active');
                    if (data.error) throw new Error(data.error);
                    addMessage(cleanLatex(data.answer), 'ai');
                } catch (error) {
                    document.getElementById('typing').classList.remove('active');
                    addMessage('‚ùå –û—à–∏–±–∫–∞: ' + (error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ'), 'ai');
                }
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞
            if (currentMode === 'tutor' && !isPro && !testMode && messageCount >= CONFIG.DAILY_LIMIT) {
                showToast('–õ–∏–º–∏—Ç 10 —Ä–µ—à–µ–Ω–∏–π/–¥–µ–Ω—å');
                showPaywall();
                return;
            }

            if (navigator.vibrate) navigator.vibrate(50);

            addMessage(text, 'user');
            input.value = '';
            input.style.height = 'auto';
            document.getElementById('typing').classList.add('active');
            document.getElementById('send-btn').disabled = true;

            try {
                const response = await fetch(`${CONFIG.SUPABASE_URL}/functions/v1/solve-task`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_KEY}`
                    },
                    body: JSON.stringify({
                        mode: currentMode,
                        message: text,
                        system: CONFIG.MODES[currentMode].system,
                        user_pro: isPro || testMode
                    })
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                document.getElementById('typing').classList.remove('active');
                if (data.error) throw new Error(typeof data.error === 'object' ? JSON.stringify(data.error) : data.error);
                
                lastTask = { question: text, image: null, shortAnswer: data.answer.substring(0, 500) };
                
                // –î–æ–±–∞–≤–ª—è–µ–º —ç—Å–∫–∞–ª–∞—Ü–∏—é –¥–ª—è —é—Ä–∏—Å—Ç–∞ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –∫–µ–π—Å–∞—Ö
                let answer = cleanLatex(data.answer);
                if (currentMode === 'lawyer' && isComplexLegalCase(text)) {
                    answer += createEscalationBox('lawyer');
                }
                
                addMessage(answer, 'ai');

                if (currentMode === 'tutor' && !isPro && !testMode) {
                    messageCount++;
                    localStorage.setItem(`usage_${new Date().toDateString()}`, messageCount);
                    updateCredits();
                }
            } catch (error) {
                document.getElementById('typing').classList.remove('active');
                addMessage('‚ùå –û—à–∏–±–∫–∞: ' + (error.message || String(error)), 'ai');
            } finally {
                document.getElementById('send-btn').disabled = false;
            }
        }

        function isComplexLegalCase(text) {
            const complexKeywords = [
                '—É–≥–æ–ª–æ–≤–Ω–æ–µ', '–±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ', '–î–¢–ü', '—Å–º–µ—Ä—Ç—å', '—É–±–∏–π—Å—Ç–≤–æ', 
                '—Ä–∞–∑–≤–æ–¥ —Å —Ä–∞–∑–¥–µ–ª–æ–º', '–º–∏–ª–ª–∏–æ–Ω', '–±–∏–∑–Ω–µ—Å', 'ooo', '–æ–æ–æ', 
                '–∏–ø', '—Å—É–¥', '–∏—Å–∫–æ–≤–æ–µ', '–∞–¥–≤–æ–∫–∞—Ç', '—é—Ä–∏—Å—Ç', '—Ç—é—Ä—å–º–∞', '—Å—Ä–æ–∫'
            ];
            const lowerText = text.toLowerCase();
            return complexKeywords.some(k => lowerText.includes(k));
        }

        function createEscalationBox(type) {
            if (type === 'lawyer') {
                return `
                    <div class="escalation-box">
                        ‚öñÔ∏è <strong>–°–ª–æ–∂–Ω—ã–π —Å–ª—É—á–∞–π?</strong><br>
                        AI –ø–æ–º–æ–≥–∞–µ—Ç —Å —Ç–∏–ø–æ–≤—ã–º–∏ —Å–∏—Ç—É–∞—Ü–∏—è–º–∏. –î–ª—è –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, 
                        –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —Å—É–¥–µ–±–Ω—ã—Ö —Ä–∞–∑–±–∏—Ä–∞—Ç–µ–ª—å—Å—Ç–≤–∞—Ö, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–º—É —é—Ä–∏—Å—Ç—É.<br>
                        <button onclick="showToast('–§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">
                            –ù–∞–π—Ç–∏ —é—Ä–∏—Å—Ç–∞ —Ä—è–¥–æ–º
                        </button>
                    </div>
                `;
            }
            return '';
        }

        async function takePhoto() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('camera-canvas');
            const ctx = canvas.getContext('2d');
            
            if (!video.videoWidth || !video.videoHeight) {
                showToast('‚ùå –ö–∞–º–µ—Ä–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞');
                return;
            }
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            const imageData = canvas.toDataURL('image/jpeg', 0.8);
            closeCamera();
            await processImage(imageData, '[üì∑ –§–æ—Ç–æ —Å –∫–∞–º–µ—Ä—ã]');
        }

        async function processImage(imageData, caption) {
            if (!imageData || typeof imageData !== 'string' || !imageData.startsWith('data:image')) {
                showToast('‚ùå –û—à–∏–±–∫–∞: —Ñ–æ—Ç–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–æ');
                return;
            }
            
            if (currentMode === 'tutor' && !isPro && !testMode && messageCount >= CONFIG.DAILY_LIMIT) {
                showToast('–õ–∏–º–∏—Ç 10 —Ä–µ—à–µ–Ω–∏–π/–¥–µ–Ω—å');
                showPaywall();
                return;
            }

            addMessage(caption, 'user', imageData);
            showToast('üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é...');
            document.getElementById('typing').classList.add('active');
            document.getElementById('send-btn').disabled = true;

            try {
                const payload = { imageBase64: imageData, mode: currentMode, user_pro: isPro || testMode };

                const response = await fetch(`${CONFIG.SUPABASE_URL}/functions/v1/solve-vision`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${SUPABASE_KEY}` },
                    body: JSON.stringify(payload)
                });

                document.getElementById('typing').classList.remove('active');
                document.getElementById('send-btn').disabled = false;

                if (!response.ok) {
                    let errorText = `–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`;
                    try {
                        const errData = await response.json();
                        errorText = errData.error || errData.message || errorText;
                    } catch(e) { errorText = await response.text() || errorText; }
                    throw new Error(errorText);
                }
                
                const data = await response.json();
                if (data.error) throw new Error(typeof data.error === 'object' ? JSON.stringify(data.error) : data.error);
                if (!data.answer) throw new Error('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                
                lastTask = { question: caption, image: imageData, shortAnswer: data.answer.substring(0, 500) };
                addMessage(cleanLatex(data.answer), 'ai');

                if (currentMode === 'tutor' && !isPro && !testMode) {
                    messageCount++;
                    localStorage.setItem(`usage_${new Date().toDateString()}`, messageCount);
                    updateCredits();
                }
            } catch (error) {
                document.getElementById('typing').classList.remove('active');
                document.getElementById('send-btn').disabled = false;
                addMessage('‚ùå –û—à–∏–±–∫–∞: ' + (error.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'ai');
                showToast('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å');
            }
        }

        async function openCamera() {
            if (currentMode !== 'tutor' && !isPro && !testMode) {
                showToast('–ö–∞–º–µ—Ä–∞ –≤ PRO-—Ä–µ–∂–∏–º–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π');
                showPaywall();
                return;
            }
            
            document.getElementById('camera-modal').classList.add('active');
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' }, audio: false });
                document.getElementById('camera-video').srcObject = stream;
            } catch (err) {
                showToast('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ');
                closeCamera();
            }
        }

        function closeCamera() {
            document.getElementById('camera-modal').classList.remove('active');
            if (stream) { stream.getTracks().forEach(track => track.stop()); stream = null; }
        }

        function handleFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            if (file.size > 5 * 1024 * 1024) { showToast('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å 5MB)'); return; }
            if (!file.type.startsWith('image/')) { showToast('–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ñ–æ—Ç–æ'); return; }
            
            const reader = new FileReader();
            reader.onload = (e) => processImage(e.target.result, '[üì∑ –§–æ—Ç–æ –∏–∑ –≥–∞–ª–µ—Ä–µ–∏]');
            reader.onerror = () => showToast('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
            reader.readAsDataURL(file);
            event.target.value = '';
        }

        async function initPayment() {
            showToast('–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞...');
            try {
                const userId = localStorage.getItem('user_id') || 'user_' + Date.now();
                localStorage.setItem('user_id', userId);

                const response = await fetch(`${CONFIG.SUPABASE_URL}/functions/v1/create-payment`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${SUPABASE_KEY}` },
                    body: JSON.stringify({ user_id: userId, return_url: 'https://arharius.github.io/aura-pay/?payment=success' })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error);
                if (data.confirmation_url) window.location.href = data.confirmation_url;
            } catch (err) {
                showToast('–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã: ' + (err.message || '—Å–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞'));
            }
        }

        function addMessage(content, type, image = null) {
            const div = document.createElement('div');
            div.className = `message ${type}`;
            if (image && type === 'user') {
                div.innerHTML = `<img src="${image}" alt="–§–æ—Ç–æ" style="max-width:100%;border-radius:8px;margin-bottom:8px;"><div>${content}</div>`;
            } else {
                div.innerHTML = content;
            }
            document.getElementById('messages').appendChild(div);
            document.getElementById('chat-container').scrollTop = document.getElementById('chat-container').scrollHeight;
            saveCurrentChat();
        }

        function updateCredits() {
            const el = document.getElementById('credits-display');
            if (testMode) {
                el.textContent = 'TEST';
                el.classList.add('test');
            } else if (isPro) {
                el.textContent = '‚àû/‚àû';
                el.classList.remove('test');
            } else {
                const remaining = Math.max(0, CONFIG.DAILY_LIMIT - messageCount);
                el.textContent = `${remaining}/${CONFIG.DAILY_LIMIT}`;
                el.classList.remove('test');
                el.style.color = remaining <= 3 ? '#ff1744' : '';
            }
        }

        function showPaywall() { document.getElementById('paywall').classList.add('active'); }
        function closePaywall() { document.getElementById('paywall').classList.remove('active'); }
        
        function showToast(msg) { 
            const t = document.getElementById('toast'); 
            t.textContent = msg; 
            t.classList.add('show'); 
            setTimeout(() => t.classList.remove('show'), 3000); 
        }

        function clearChat() {
            if(confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞?')) {
                localStorage.removeItem(`aura_chat_${currentMode}`);
                lastTask = { question: null, image: null, shortAnswer: null };
                
                const welcomeText = CONFIG.MODES[currentMode].welcome;
                document.getElementById('messages').innerHTML = `<div class="message ai">${welcomeText}</div>`;
                
                showToast('‚úÖ –ß–∞—Ç –æ—á–∏—â–µ–Ω');
            }
        }

        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('payment') === 'success') {
            const expiryDate = new Date();
            expiryDate.setDate(expiryDate.getDate() + 30);
            localStorage.setItem('aura_pro', 'true');
            localStorage.setItem('aura_pro_expiry', expiryDate.toISOString());
            isPro = true;
            updateCredits();
            updateModeTabs();
            showToast('‚úÖ PRO –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –Ω–∞ 30 –¥–Ω–µ–π!');
            window.history.replaceState({}, document.title, window.location.pathname);
        }
    </script>
</body>
</html>
