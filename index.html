<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura AI - DEBUG</title>
    <style>
        body { background: #0a0e27; color: white; font-family: Arial; padding: 20px; max-width: 600px; margin: 0 auto; }
        .log { background: rgba(0,0,0,0.5); padding: 10px; margin: 10px 0; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
        .error { color: #ff4757; }
        .success { color: #2ed573; }
        button { background: #00d4ff; border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: bold; margin: 5px; }
        input { width: 100%; padding: 10px; margin: 10px 0; border-radius: 8px; border: 1px solid #333; background: rgba(255,255,255,0.1); color: white; }
    </style>
</head>
<body>
    <h2>üîß –û—Ç–ª–∞–¥–∫–∞ Aura AI</h2>
    <div id="status">–°—Ç–∞—Ç—É—Å: –û–∂–∏–¥–∞–Ω–∏–µ...</div>
    
    <div class="log" id="log"></div>
    
    <input type="text" id="test-input" value="2+2" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞—á—É">
    <button onclick="testConnection()">1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å —Å —Å–µ—Ä–≤–µ—Ä–æ–º</button>
    <button onclick="sendTest()">2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å</button>
    
    <div style="margin-top: 20px; padding: 15px; background: rgba(255,165,2,0.1); border-radius: 8px; font-size: 14px;">
        <b>–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b><br>
        1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12 ‚Üí Console)<br>
        2. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å"<br>
        3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫—É —Å—é–¥–∞
    </div>

    <script>
        const CONFIG = {
            URL: 'https://tgumghgowexcuzlnqnoa.supabase.co/functions/v1/solve-task',
            KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRndW1naGdvd2V4Y3V6bG5xbm9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzExNTAzNTEsImV4cCI6MjA4NjcyNjM1MX0.PWSpyTL8w4s567OeulBrmhm3x7T-nqrvfeE0Cp8Jcbw'
        };

        function log(msg, isError=false) {
            const div = document.getElementById('log');
            const line = document.createElement('div');
            line.className = isError ? 'error' : 'success';
            line.textContent = new Date().toLocaleTimeString() + ': ' + msg;
            div.appendChild(line);
            div.scrollTop = div.scrollHeight;
            console.log(msg);
        }

        async function testConnection() {
            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ —Å Supabase...');
            document.getElementById('status').textContent = '–°—Ç–∞—Ç—É—Å: –ü—Ä–æ–≤–µ—Ä–∫–∞...';
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç
                
                const response = await fetch(CONFIG.URL, {
                    method: 'OPTIONS',
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                log('–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª: ' + response.status + ' ' + response.statusText);
                document.getElementById('status').textContent = '–°—Ç–∞—Ç—É—Å: –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω';
                
            } catch (e) {
                log('–û–®–ò–ë–ö–ê: ' + e.message, true);
                document.getElementById('status').textContent = '–°—Ç–∞—Ç—É—Å: –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏';
                
                if (e.message.includes('Failed to fetch')) {
                    log('–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:', true);
                    log('1. Supabase "–∑–∞—Å–Ω—É–ª" (–∂–¥–∏—Ç–µ 30 —Å–µ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ)', true);
                    log('2. CORS –æ—à–∏–±–∫–∞ (–æ—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ http://, –Ω–µ file://)', true);
                    log('3. –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞', true);
                }
            }
        }

        async function sendTest() {
            const text = document.getElementById('test-input').value || '2+2';
            log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: "' + text + '"...');
            
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 15000); // 15 —Å–µ–∫
                
                const response = await fetch(CONFIG.URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + CONFIG.KEY
                    },
                    body: JSON.stringify({
                        message: text,
                        mode: 'tutor',
                        system: '–¢—ã –ø–æ–º–æ—â–Ω–∏–∫. –û—Ç–≤–µ—Ç—å –ø—Ä–æ—Å—Ç–æ: 2+2=4',
                        user_pro: true
                    }),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: ' + response.status);
                
                if (!response.ok) {
                    const text = await response.text();
                    log('–û—à–∏–±–∫–∞ HTTP ' + response.status + ': ' + text, true);
                    return;
                }
                
                const data = await response.json();
                log('–£—Å–ø–µ—Ö! –û—Ç–≤–µ—Ç: ' + JSON.stringify(data).substring(0, 200));
                
            } catch (e) {
                log('–û–®–ò–ë–ö–ê –∑–∞–ø—Ä–æ—Å–∞: ' + e.message, true);
                if (e.name === 'AbortError') {
                    log('–¢–∞–π–º–∞—É—Ç (15 —Å–µ–∫). Supabase probably sleeping.', true);
                    log('–ü–æ–¥–æ–∂–¥–∏—Ç–µ 30 —Å–µ–∫—É–Ω–¥ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ.', true);
                }
            }
        }

        // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = () => {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            log('User Agent: ' + navigator.userAgent.substring(0, 50));
            if (window.location.protocol === 'file:') {
                log('–í–ù–ò–ú–ê–ù–ò–ï: –û—Ç–∫—Ä—ã—Ç–æ –∫–∞–∫ —Ñ–∞–π–ª (file://). –ú–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å CORS!', true);
            }
        };
    </script>
</body>
</html>
