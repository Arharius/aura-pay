<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aura AI</title>
    <script src="https://yookassa.ru/checkout-widget/v1/checkout-widget.js"></script>
    <style>
        body {
            background: #0f0c29; color: white; font-family: -apple-system, sans-serif;
            margin: 0; padding: 10px; display: flex; flex-direction: column; min-height: 100vh;
        }
        .container { max-width: 600px; margin: 0 auto; width: 100%; flex-grow: 1; display: flex; flex-direction: column; }
        
        /* –ö–†–ê–°–ò–í–ê–Ø –ó–ê–ì–õ–£–®–ö–ê –î–õ–Ø –ú–û–î–ï–†–ê–¢–û–†–ê */
        #offline-screen {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0f0c29; z-index: 10000; flex-direction: column; align-items: center; justify-content: center;
        }

        /* –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –í–ò–î–ñ–ï–¢ */
        .weather-banner {
            background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(0, 210, 255, 0.2);
            border-radius: 15px; padding: 15px; margin: 10px 0; text-align: center; font-size: 14px;
        }

        #chat-container { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 10px; }
        .msg { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 14px; margin-bottom: 5px; }
        .msg-user { align-self: flex-end; background: #9733ee; }
        .msg-ai { align-self: flex-start; background: rgba(255,255,255,0.1); }

        .input-box { background: rgba(255,255,255,0.07); border-radius: 20px; padding: 15px; margin-top: auto; }
        textarea { width: 100%; background: transparent; border: none; color: white; resize: none; outline: none; height: 40px; }
        
        .pricing { background: rgba(151, 51, 238, 0.1); border: 1px solid #9733ee; border-radius: 15px; padding: 15px; text-align: center; margin-top: 15px; }
        .btn { background: #9733ee; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="offline-screen">
    <div style="font-size: 60px;">üì°</div>
    <h2 style="margin: 20px 0 10px;">–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</h2>
    <p style="color: #8a8d91; margin-bottom: 20px;">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ç–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã Aura AI</p>
    <button class="btn" onclick="location.reload()">–û–ë–ù–û–í–ò–¢–¨ –°–¢–†–ê–ù–ò–¶–£</button>
</div>

<div class="container">
    <h1 style="font-size: 22px; color: #00d2ff;">Aura AI</h1>

    <div class="weather-banner">
        <div id="weather-text">üåç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –≤ –≤–∞—à–µ–º –≥–æ—Ä–æ–¥–µ...</div>
    </div>

    <div id="chat-container"></div>

    <div class="input-box" id="ui-main">
        <textarea id="user-input" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å..."></textarea>
        <div style="display: flex; justify-content: flex-end;">
            <button class="btn" onclick="sendToAI()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <div class="pricing" id="pricing">
        <div style="font-size: 18px; font-weight: bold;">Aura Pro ‚Äî 990 ‚ÇΩ</div>
        <div style="font-size: 12px; margin-bottom: 10px;">–ë–µ–∑–ª–∏–º–∏—Ç –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –º–æ–¥–µ–ª–∏</div>
        <button class="btn" style="width: 100%;" onclick="alert('–ü–ª–∞—Ç–µ–∂–∏ –∞–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è –±–∞–Ω–∫–æ–º...')">–ö—É–ø–∏—Ç—å –¥–æ—Å—Ç—É–ø</button>
    </div>
    
    <footer style="font-size: 10px; text-align: center; margin-top: 20px; opacity: 0.5;">
        –ò–ü –®–∫—É—Ä–µ–Ω–∫–æ –ê.–ê. | –ò–ù–ù 614550465916
    </footer>
</div>

<script>
    const SUPABASE_URL = 'https://tgumghgowexcuzlnqnoa.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_O7VDJMTOc45bFS8l6K-ilg_pkQ2PCax'; 
    const DEEPSEEK_KEY = 'sk-a5e1d303aeee4ecdade7de51b6768a58';

    let userId = localStorage.getItem('aura_id') || 'user_' + Math.random().toString(36).substr(2, 9);
    localStorage.setItem('aura_id', userId);
    let msgCount = parseInt(localStorage.getItem('aura_count') || '0');
    let isPro = false;

    // 1. –ü–†–û–í–ï–†–ö–ê –ò–ù–¢–ï–†–ù–ï–¢–ê –î–õ–Ø –ú–û–î–ï–†–ê–¶–ò–ò
    function checkNetwork() {
        const screen = document.getElementById('offline-screen');
        if (!navigator.onLine) {
            screen.style.display = 'flex';
        } else {
            screen.style.display = 'none';
        }
    }
    window.addEventListener('online', checkNetwork);
    window.addEventListener('offline', checkNetwork);

    // 2. –ë–´–°–¢–†–ê–Ø –ü–û–ì–û–î–ê
    async function updateWeather() {
        try {
            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=55.75&longitude=37.61&current_weather=true');
            const data = await res.json();
            document.getElementById('weather-text').innerText = `üìç –ú–æ—Å–∫–≤–∞: ${Math.round(data.current_weather.temperature)}¬∞C, —Å–µ–π—á–∞—Å –ø–æ–¥—Ö–æ–¥—è—â–µ–µ –≤—Ä–µ–º—è –¥–ª—è —á–∞—Ç–∞!`;
        } catch(e) { document.getElementById('weather-text').innerText = "üìç –ü–æ–≥–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"; }
    }

    // 3. –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê –í –ë–ê–ó–ï
    async function checkPro() {
        try {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/payments?user_id=eq.${userId}&status=eq.success`, {
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
            });
            const data = await res.json();
            if (data.length > 0) {
                isPro = true;
                document.getElementById('pricing').style.display = 'none';
            }
        } catch(e) {}
    }

    async function sendToAI() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        if (!text || !navigator.onLine) return;

        if (msgCount >= 3 && !isPro) {
            alert("–õ–∏–º–∏—Ç 3 —Å–æ–æ–±—â–µ–Ω–∏—è –∏—Å—á–µ—Ä–ø–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫—É–ø–∏—Ç–µ Pro-–¥–æ—Å—Ç—É–ø.");
            return;
        }

        addMsg('user', text);
        input.value = "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...";
        
        try {
            const res = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_KEY}`},
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [{role: "system", content: "–¢—ã Aura AI. –¢—ã –∑–Ω–∞–µ—à—å –ø–æ–≥–æ–¥—É (–æ–Ω–∞ —É–∫–∞–∑–∞–Ω–∞ –≤ –≤–∏–¥–∂–µ—Ç–µ) –∏ –≤—Å–µ–≥–¥–∞ –ø–æ–º–æ–≥–∞–µ—à—å."}, {role: "user", content: text}]
                })
            });
            const data = await res.json();
            addMsg('ai', data.choices[0].message.content);
            msgCount++;
            localStorage.setItem('aura_count', msgCount);
        } catch(e) { addMsg('ai', '–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º.'); }
        input.value = "";
    }

    function addMsg(role, text) {
        const cont = document.getElementById('chat-container');
        cont.innerHTML += `<div class="msg msg-${role}">${text}</div>`;
        cont.scrollTop = cont.scrollHeight;
    }

    window.onload = () => { checkNetwork(); updateWeather(); checkPro(); addMsg('ai', '–ü—Ä–∏–≤–µ—Ç! –Ø Aura AI. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?'); };
</script>
</body>
</html>
