<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aura AI App</title>
    <style>
        :root {
            --bg: #0f0c29;
            --accent: #00d2ff;
            --pro: #da22ff;
            --text: #ffffff;
            --nav-bg: #161b33;
        }

        body {
            background: var(--bg);
            background-image: linear-gradient(315deg, #0f0c29 0%, #302b63 74%);
            color: var(--text); font-family: -apple-system, system-ui, sans-serif;
            margin: 0; padding: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* –≠–ö–†–ê–ù–´ */
        .screen {
            flex-grow: 1; display: none; flex-direction: column;
            padding: 20px; padding-bottom: 80px; overflow-y: auto; box-sizing: border-box;
        }
        .active { display: flex; }

        /* HEADER */
        header {
            padding: 15px 20px; background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        header h1 { margin: 0; font-size: 18px; font-weight: 800; letter-spacing: 1px; }
        .weather-pill { background: rgba(0,210,255,0.1); padding: 4px 10px; border-radius: 20px; font-size: 11px; color: var(--accent); border: 1px solid var(--accent); }

        /* –ß–ê–¢ */
        #chat-flow { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; margin-bottom: 10px; }
        .bubble { max-width: 85%; padding: 12px 16px; border-radius: 20px; font-size: 14px; line-height: 1.5; }
        .user { align-self: flex-end; background: linear-gradient(135deg, #6a11cb, #2575fc); }
        .ai { align-self: flex-start; background: rgba(255,255,255,0.1); }

        .input-group { display: flex; gap: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 15px; }
        input { flex-grow: 1; background: transparent; border: none; color: white; outline: none; font-size: 14px; }
        .send-circle { width: 35px; height: 35px; border-radius: 50%; background: var(--accent); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; }

        /* –ö–ê–†–¢–û–ß–ö–ò –ò–ù–°–¢–†–£–ú–ï–ù–¢–û–í */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .card { 
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 18px; padding: 15px; text-align: center; transition: 0.3s;
        }
        .card:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }
        .card i { font-size: 24px; display: block; margin-bottom: 8px; }
        .card span { font-size: 12px; font-weight: 600; color: #ccc; }

        /* –ü–†–û–§–ò–õ–¨ */
        .promo-box {
            background: linear-gradient(135deg, #da22ff, #9733ee);
            padding: 20px; border-radius: 20px; text-align: center; margin-top: 20px;
        }
        .buy-btn { width: 100%; padding: 15px; border-radius: 12px; border: none; background: white; color: #9733ee; font-weight: 800; font-size: 14px; margin-top: 15px; }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø (TAB BAR) */
        nav {
            position: fixed; bottom: 0; width: 100%; height: 65px;
            background: var(--nav-bg); display: flex; justify-content: space-around;
            align-items: center; border-top: 1px solid rgba(255,255,255,0.1);
        }
        .nav-link { color: #666; text-align: center; font-size: 10px; text-decoration: none; cursor: pointer; }
        .nav-link.active { color: var(--accent); }
        .nav-link i { font-size: 20px; display: block; margin-bottom: 4px; }

        /* –ó–ê–ì–õ–£–®–ö–ê –ë–õ–û–ö–ò–†–û–í–ö–ò */
        #blocker { display: flex; position: fixed; inset: 0; background: var(--bg); z-index: 10000; align-items: center; justify-content: center; flex-direction: column; text-align: center; padding: 30px; }
    </style>
</head>
<body>

<div id="blocker">
    <div style="font-size: 50px;">üì°</div>
    <h2>–ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</h2>
    <p>–î–ª—è —Ä–∞–±–æ—Ç—ã Aura AI —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ç–∏.</p>
    <button onclick="location.reload()" style="padding: 12px 25px; background: var(--accent); border: none; border-radius: 10px; font-weight: bold;">–û–ë–ù–û–í–ò–¢–¨</button>
</div>

<header>
    <h1>AURA AI</h1>
    <div id="weather" class="weather-pill">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</header>

<div id="screen-chat" class="screen active">
    <div id="chat-flow">
        <div class="bubble ai">–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç Aura. –û —á–µ–º —Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å?</div>
    </div>
    <div class="input-group">
        <input type="text" id="user-msg" placeholder="–°–ø—Ä–æ—Å–∏ –æ —á–µ–º —É–≥–æ–¥–Ω–æ...">
        <button class="send-circle" onclick="sendMessage()">‚û§</button>
    </div>
</div>

<div id="screen-tools" class="screen">
    <h2 style="font-size: 20px;">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h2>
    <p style="color: #888; font-size: 13px;">–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤—É—é –∑–∞–¥–∞—á—É –¥–ª—è –ò–ò</p>
    <div class="grid">
        <div class="card" onclick="quickTask('–ù–∞–ø–∏—à–∏ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ—Å—Ç–∞ –≤ —Å–æ—Ü—Å–µ—Ç–∏ –Ω–∞ —Ç–µ–º—É: ')"><i>üìù</i><span>–ü–æ—Å—Ç –¥–ª—è —Å–æ—Ü—Å–µ—Ç–µ–π</span></div>
        <div class="card" onclick="quickTask('–ü–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–µ–∫—Å—Ç: ')"><i>üåç</i><span>–ü–µ—Ä–µ–≤–æ–¥—á–∏–∫</span></div>
        <div class="card" onclick="quickTask('–ü—Ä–∏–¥—É–º–∞–π 5 –∏–¥–µ–π –ø–æ–¥–∞—Ä–∫–∞ –¥–ª—è: ')"><i>üéÅ</i><span>–ò–¥–µ–∏ –ø–æ–¥–∞—Ä–∫–æ–≤</span></div>
        <div class="card" onclick="quickTask('–ò—Å–ø—Ä–∞–≤—å –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ —Ç–µ–∫—Å—Ç–µ: ')"><i>‚úÖ</i><span>–ö–æ—Ä—Ä–µ–∫—Ç–æ—Ä</span></div>
        <div class="card" onclick="quickTask('–°–æ—Å—Ç–∞–≤—å –º–µ–Ω—é –Ω–∞ –¥–µ–Ω—å —Å —Ä–µ—Ü–µ–ø—Ç–∞–º–∏ –¥–ª—è: ')"><i>ü•ó</i><span>–ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è</span></div>
        <div class="card" onclick="quickTask('–ù–∞–ø–∏—à–∏ –ø–ª–∞–Ω —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: ')"><i>üí™</i><span>–§–∏—Ç–Ω–µ—Å-–ø–ª–∞–Ω</span></div>
    </div>
</div>

<div id="screen-profile" class="screen">
    <h2 style="font-size: 20px;">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-top: 10px;">
        <span style="color: #888; font-size: 12px;">–°—Ç–∞—Ç—É—Å:</span>
        <div id="status-txt" style="font-weight: bold; margin-top: 5px;">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è (3/3)</div>
    </div>

    <div id="pay-card" class="promo-box">
        <h3 style="margin:0">AURA PRO</h3>
        <p style="font-size: 12px; opacity: 0.9;">–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –±–µ–∑–ª–∏–º–∏—Ç–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –æ—Ç –ò–ò.</p>
        <div style="font-size: 22px; font-weight: 900;">990 ‚ÇΩ / –º–µ—Å</div>
        <button class="buy-btn" onclick="openPayment()">–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨</button>
    </div>
    
    <button onclick="localStorage.clear(); location.reload();" style="margin-top: 20px; width: 100%; background: none; border: 1px solid #444; color: #888; padding: 10px; border-radius: 10px; font-size: 12px;">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –∏—Å—Ç–æ—Ä–∏—é</button>
    <p style="text-align: center; font-size: 10px; color: #555; margin-top: 20px;">–ò–ü –®–∫—É—Ä–µ–Ω–∫–æ –ê–Ω–¥—Ä–µ–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á</p>
</div>

<nav>
    <div class="nav-link active" id="nav-chat" onclick="showScreen('chat')"><i>üí¨</i>–ß–∞—Ç</div>
    <div class="nav-link" id="nav-tools" onclick="showScreen('tools')"><i>üõ†</i>–ó–∞–¥–∞—á–∏</div>
    <div class="nav-link" id="nav-profile" onclick="showScreen('profile')"><i>üë§</i>–ü—Ä–æ—Ñ–∏–ª—å</div>
</nav>

<script>
    // === –í–°–¢–ê–í–¨ –ö–õ–Æ–ß–ò ===
    const SUPABASE_URL = 'https://tgumghgowexcuzlnqnoa.supabase.co'; 
    const SUPABASE_KEY = 'sb_publishable_O7VDJMTOc45bFS8l6K-ilg_pkQ2PCax'; 
    const DEEPSEEK_KEY = 'sk-a5e1d303aeee4ecdade7de51b6768a58';
    const PAYMENT_LINK = 'live_jsfec4_iwjcgWGj-49Uhr4-Bdfbuqd6uXj9BnZmlV7U'; 
    // ====================

    let userId = localStorage.getItem('aura_id') || ('u'+Math.random().toString(36).substr(2,7));
    localStorage.setItem('aura_id', userId);
    let msgCount = parseInt(localStorage.getItem('aura_c') || '0');
    let isPro = false;

    // –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í
    function showScreen(name) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
        document.getElementById('screen-' + name).classList.add('active');
        document.getElementById('nav-' + name).classList.add('active');
    }

    // –ë–´–°–¢–†–´–ï –ó–ê–î–ê–ß–ò
    function quickTask(prompt) {
        showScreen('chat');
        document.getElementById('user-msg').value = prompt;
        document.getElementById('user-msg').focus();
    }

    // –°–ï–¢–¨
    function checkNet() {
        if (navigator.onLine) {
            document.getElementById('blocker').style.display = 'none';
            updateWeather();
            checkStatus();
        }
    }
    setInterval(checkNet, 2000);

    // –ü–û–ì–û–î–ê
    async function updateWeather() {
        try {
            const r = await fetch('https://api.open-meteo.com/v1/forecast?latitude=55.75&longitude=37.61&current_weather=true');
            const d = await r.json();
            document.getElementById('weather').innerText = `–ú–æ—Å–∫–≤–∞: ${Math.round(d.current_weather.temperature)}¬∞C`;
        } catch(e) {}
    }

    // –ß–ê–¢
    async function sendMessage() {
        const input = document.getElementById('user-msg');
        const text = input.value.trim();
        if(!text || !navigator.onLine) return;

        if(msgCount >= 3 && !isPro) {
            alert("–õ–∏–º–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å—á–µ—Ä–ø–∞–Ω. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è –ø–æ–∫—É–ø–∫–∏ PRO.");
            showScreen('profile');
            return;
        }

        addBubble(text, 'user');
        input.value = '...';

        try {
            const res = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_KEY}`},
                body: JSON.stringify({
                    model: "deepseek-chat",
                    messages: [{role:"system", content:"–¢—ã Aura AI, –º–æ–±–∏–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫."}, {role:"user", content:text}]
                })
            });
            const data = await res.json();
            addBubble(data.choices[0].message.content, 'ai');
            msgCount++;
            localStorage.setItem('aura_c', msgCount);
            updateStatusText();
        } catch(e) { alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å –ò–ò"); }
        input.value = '';
    }

    function addBubble(txt, type) {
        const flow = document.getElementById('chat-flow');
        const b = document.createElement('div');
        b.className = `bubble ${type}`;
        b.innerText = txt;
        flow.appendChild(b);
        flow.scrollTop = flow.scrollHeight;
    }

    function updateStatusText() {
        if(!isPro) document.getElementById('status-txt').innerText = `–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è (${3-msgCount < 0 ? 0 : 3-msgCount}/3 –∑–∞–ø—Ä–æ—Å–∞)`;
    }

    // –ü–†–û–í–ï–†–ö–ê –û–ü–õ–ê–¢–´
    async function checkStatus() {
        try {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/payments?user_id=eq.${userId}&status=eq.success`, {
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
            });
            const data = await res.json();
            if(data.length > 0) {
                isPro = true;
                document.getElementById('status-txt').innerText = "Aura PRO –∞–∫—Ç–∏–≤–Ω–∞";
                document.getElementById('pay-card').style.display = 'none';
            }
        } catch(e){}
    }

    function openPayment() { window.location.href = PAYMENT_LINK; }

    window.onload = () => { checkNet(); updateStatusText(); };
</script>
</body>
</html>
