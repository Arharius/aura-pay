<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aura AI ‚Äî –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</title>
    <script src="https://yookassa.ru/checkout-widget/v1/checkout-widget.js"></script>
    <style>
        body {
            background: #0f0c29; color: white; font-family: -apple-system, sans-serif;
            margin: 0; padding: 10px; display: flex; flex-direction: column; min-height: 100vh;
        }
        /* –ó–ê–ì–õ–£–®–ö–ê –í–ò–î–ò–ú–ê –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ –î–õ–Ø –ú–û–î–ï–†–ê–¶–ò–ò */
        #offline-screen {
            display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0f0c29; z-index: 10000; flex-direction: column; align-items: center; 
            justify-content: center; text-align: center;
        }
        .container { display: none; max-width: 600px; margin: 0 auto; width: 100%; flex-grow: 1; flex-direction: column; }
        .weather-banner { background: rgba(255,255,255,0.05); border: 1px solid rgba(0,210,255,0.2); border-radius: 15px; padding: 12px; margin: 10px 0; text-align: center; font-size: 14px; }
        #chat-container { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 20px; }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 15px; line-height: 1.5; }
        .msg-ai { align-self: flex-start; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.05); }
        .msg-user { align-self: flex-end; background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); }
        .input-area { background: rgba(255,255,255,0.08); border-radius: 22px; padding: 15px; margin: 15px 0; }
        textarea { width: 100%; background: transparent; border: none; color: white; font-size: 16px; outline: none; resize: none; min-height: 44px; }
        .btn { background: #9733ee; color: white; border: none; padding: 10px 22px; border-radius: 14px; font-weight: bold; cursor: pointer; }
        .pricing { background: rgba(151,51,238,0.1); border: 1px solid #9733ee; border-radius: 20px; padding: 20px; text-align: center; margin-bottom: 20px; }
        footer { padding: 15px; font-size: 10px; color: #8a8d91; text-align: center; }
    </style>
</head>
<body>

<div id="offline-screen">
    <div style="font-size: 80px; margin-bottom: 20px;">üì°</div>
    <h2 style="color: #00d2ff; margin: 0 0 10px;">–ù–ï–¢ –°–í–Ø–ó–ò</h2>
    <p style="color: #aab2bd; padding: 0 40px;">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—é Aura AI —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</p>
    <button class="btn" onclick="location.reload()" style="margin-top: 20px;">–ü–û–í–¢–û–†–ò–¢–¨ –ü–û–ü–´–¢–ö–£</button>
</div>

<div class="container" id="app-content">
    <div style="display:flex; justify-content:space-between; align-items:center;">
        <h1 style="background: linear-gradient(#00d2ff, #3a7bd5); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Aura AI</h1>
        <button onclick="clearHistory()" style="background:none; border:none; color:#ff4b2b; font-size:11px; cursor:pointer;">–û–ß–ò–°–¢–ò–¢–¨</button>
    </div>
    
    <div class="weather-banner" id="weather-text">üìç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã...</div>

    <div id="chat-container"></div>

    <div class="input-area" id="input-block">
        <div id="role-display" style="font-size:10px; color:#00ff88; margin-bottom:8px;">‚óè –†–ï–ñ–ò–ú: –û–ë–©–ò–ô –ü–û–ú–û–©–ù–ò–ö</div>
        <textarea id="user-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å..."></textarea>
        <div style="display:flex; justify-content:right; margin-top:10px;">
            <button class="btn" onclick="sendToAI()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <div class="pricing" id="pricing">
        <h3 style="margin:0;">–¢–∞—Ä–∏—Ñ Aura Pro</h3>
        <p style="color:#da22ff; font-weight:bold; font-size: 20px; margin: 10px 0;">990 ‚ÇΩ / –º–µ—Å</p>
        <button class="btn" style="width:100%" onclick="initPayment()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <footer>
        –ò–ü –®–∫—É—Ä–µ–Ω–∫–æ –ê–Ω–¥—Ä–µ–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á | –ò–ù–ù: 614550465916 <br>
        <a href="/privacy.html" style="color:#da22ff; text-decoration: none;">–û—Ñ–µ—Ä—Ç–∞ –∏ –ø–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
    </footer>
</div>

<div id="payment-form"></div>

<script>
    // === –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø (–í–°–¢–ê–í–¨ –°–í–û–ò –ö–õ–Æ–ß–ò –¢–£–¢) ===
    const SUPABASE_URL = 'https://tgumghgowexcuzlnqnoa.supabase.co'; //
    const SUPABASE_KEY = 'sb_publishable_R1n0Ior_q-y-i78yGjXXlw_gjfu2qm_'; //
    const DEEPSEEK_KEY = 'sk-a5e1d303aeee4ecdade7de51b6768a58';
    const YOOKASSA_TOKEN = ''; 
    // ============================================

    let userId = localStorage.getItem('aura_user_id') || ('user_' + Math.random().toString(36).substr(2, 9));
    localStorage.setItem('aura_user_id', userId);
    let messageCount = parseInt(localStorage.getItem('aura_count') || '0');
    let history = JSON.parse(localStorage.getItem('aura_history') || '[]');
    let isPro = false;

    // –ü–†–û–í–ï–†–ö–ê –°–ï–¢–ò (–ò–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞)
    function checkNetwork() {
        const offline = document.getElementById('offline-screen');
        const content = document.getElementById('app-content');
        if (navigator.onLine) {
            offline.style.display = 'none';
            content.style.display = 'flex';
        } else {
            offline.style.display = 'flex';
            content.style.display = 'none';
        }
    }

    // –ü–û–°–¢–û–Ø–ù–ù–´–ô –ú–û–ù–ò–¢–û–†–ò–ù–ì
    setInterval(checkNetwork, 1000);

    async function updateWeather() {
        try {
            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=55.75&longitude=37.61&current_weather=true');
            const data = await res.json();
            document.getElementById('weather-text').innerText = `üìç –ú–æ—Å–∫–≤–∞: ${Math.round(data.current_weather.temperature)}¬∞C. –û—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —á–∞—Ç–∞!`;
        } catch(e) { document.getElementById('weather-text').innerText = "üìç –ü–æ–≥–æ–¥–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"; }
    }

    async function checkProStatus() {
        try {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/payments?user_id=eq.${userId}&status=eq.success`, {
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
            });
            const data = await res.json();
            if (data && data.length > 0) {
                isPro = true;
                document.getElementById('pricing').style.display = 'none';
                document.getElementById('role-display').innerText += ' (PRO)';
            }
        } catch (e) { console.log("DB check skip"); }
    }

    function renderHistory() {
        const container = document.getElementById('chat-container');
        if (history.length === 0) {
            container.innerHTML = '<div class="msg msg-ai">–ü—Ä–∏–≤–µ—Ç! –Ø Aura AI. –ì–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å —Å –ª—é–±—ã–º –≤–æ–ø—Ä–æ—Å–æ–º. –û —á–µ–º –ø–æ–≥–æ–≤–æ—Ä–∏–º?</div>';
        } else {
            container.innerHTML = history.map(m => `<div class="msg ${m.role === 'user' ? 'msg-user' : 'msg-ai'}">${m.text}</div>`).join('');
        }
        container.scrollTop = container.scrollHeight;
    }

    async function sendToAI() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        if (!text || !navigator.onLine) return;

        // –õ–ò–ú–ò–¢ –°–û–û–ë–©–ï–ù–ò–ô
        if (messageCount >= 3 && !isPro) {
            alert("–õ–∏–º–∏—Ç 3 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è –∏—Å—á–µ—Ä–ø–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∞–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ Aura Pro.");
            return;
        }

        history.push({role: 'user', text: text});
        renderHistory();
        input.value = "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...";

        try {
            const res = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_KEY}`},
                body: JSON.stringify({
                    model: "deepseek-chat", 
                    messages: [{role: "system", content: "–¢—ã Aura AI. –¢—ã –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ó–Ω–∞–µ—à—å –ø–æ–≥–æ–¥—É –≤ –ú–æ—Å–∫–≤–µ (–æ–Ω–∞ –≤ –≤–∏–¥–∂–µ—Ç–µ)."}, {role: "user", content: text}]
                })
            });
            const data = await res.json();
            history.push({role: 'ai', text: data.choices[0].message.content});
            messageCount++;
            localStorage.setItem('aura_count', messageCount);
            localStorage.setItem('aura_history', JSON.stringify(history));
            renderHistory();
        } catch (e) { alert("–û—à–∏–±–∫–∞ API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á–∏ –∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç."); }
        input.value = "";
    }

    function initPayment() {
        alert("–ú–æ–¥—É–ª—å –æ–ø–ª–∞—Ç—ã Aura Pay –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –±–∞–Ω–∫–æ–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–≤–µ—Ä—à–∏—Ç—å –ø–æ–∫—É–ø–∫—É –ø–æ–∑–∂–µ.");
    }

    function clearHistory() { if(confirm("–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?")) { localStorage.clear(); location.reload(); } }

    window.onload = () => {
        checkNetwork();
        renderHistory();
        updateWeather();
        checkProStatus();
    };
</script>
</body>
</html>
