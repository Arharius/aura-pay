<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aura AI ‚Äî –ë–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç</title>
    <script src="https://yookassa.ru/checkout-widget/v1/checkout-widget.js"></script>
    <style>
        body {
            background-color: #0f0c29;
            background-image: linear-gradient(315deg, #0f0c29 0%, #302b63 74%, #24243e 100%);
            color: white; font-family: -apple-system, sans-serif;
            margin: 0; padding: 10px; display: flex; flex-direction: column; min-height: 100vh; box-sizing: border-box;
        }
        .container { max-width: 600px; margin: 0 auto; width: 100%; display: flex; flex-direction: column; flex-grow: 1; }
        h1 { font-size: 24px; margin: 0; background: linear-gradient(#00d2ff, #3a7bd5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 900; }
        
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–∏–¥–∂–µ—Ç –ø–æ–≥–æ–¥—ã */
        .weather-box {
            margin: 10px 0; border-radius: 15px; overflow: hidden; 
            background: rgba(255,255,255,0.05); border: 1px solid rgba(0,210,255,0.2);
            min-height: 98px; display: flex; align-items: center; justify-content: center;
        }

        .roles-container { display: flex; gap: 8px; overflow-x: auto; padding: 10px 0; scrollbar-width: none; }
        .role-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.1); color: white;
            padding: 8px 16px; border-radius: 20px; font-size: 12px; cursor: pointer; white-space: nowrap;
        }
        .role-btn.active { background: #9733ee; border-color: #da22ff; box-shadow: 0 0 15px rgba(151, 51, 238, 0.4); }

        #chat-container {
            flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 12px;
            padding: 15px; margin-bottom: 15px; background: rgba(0,0,0,0.2); border-radius: 20px;
        }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; font-size: 15px; line-height: 1.5; }
        .msg-user { align-self: flex-end; background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); }
        .msg-ai { align-self: flex-start; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.05); }

        .input-area { background: rgba(255,255,255,0.08); border-radius: 22px; padding: 15px; margin-bottom: 15px; }
        textarea { width: 100%; background: transparent; border: none; color: white; font-size: 16px; resize: none; outline: none; min-height: 44px; }
        .btn-send { background: #9733ee; color: white; border: none; padding: 10px 22px; border-radius: 14px; font-weight: bold; cursor: pointer; }

        .pricing-card {
            background: linear-gradient(135deg, rgba(151, 51, 238, 0.1), rgba(218, 34, 255, 0.1));
            border: 1px solid rgba(218, 34, 255, 0.3); border-radius: 20px; padding: 20px; text-align: center; margin-bottom: 20px;
        }

        #payment-form { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 400px; background: white; padding: 10px; border-radius: 24px; z-index: 2000; }
        footer { padding: 15px; font-size: 10px; color: #8a8d91; text-align: center; border-top: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body>

<div class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-top:5px;">
        <h1>Aura AI</h1>
        <button onclick="clearHistory()" style="background:none; border:none; color:#ff4b2b; font-size:11px; cursor:pointer;">–û–ß–ò–°–¢–ò–¢–¨</button>
    </div>

    <div class="weather-box">
        <a class="weatherwidget-io" href="https://forecast7.com/ru/55point7537point62/moscow/" data-label_1="–í–ê–® –ì–û–†–û–î" data-label_2="–ü–û–ì–û–î–ê" data-font="Roboto" data-icons="Climacons" data-theme="pure" data-basecolor="rgba(255, 255, 255, 0)" data-accent="rgba(0, 210, 255, 1)" data-textcolor="#ffffff" >–ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–•...</a>
        <script>
        !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','weatherwidget-io-js');
        </script>
    </div>

    <div class="roles-container">
        <button class="role-btn active" onclick="setRole(this, '–û–±—â–∏–π –ø–æ–º–æ—â–Ω–∏–∫')">ü§ñ –û–±—â–∏–π</button>
        <button class="role-btn" onclick="setRole(this, '–†–µ–ø–µ—Ç–∏—Ç–æ—Ä')">üë®‚Äçüè´ –†–µ–ø–µ—Ç–∏—Ç–æ—Ä</button>
        <button class="role-btn" onclick="setRole(this, '–Æ—Ä–∏—Å—Ç')">‚öñÔ∏è –Æ—Ä–∏—Å—Ç</button>
        <button class="role-btn" onclick="setRole(this, '–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥')">üìà –ú–∞—Ä–∫–µ—Ç</button>
    </div>

    <div id="chat-container"></div>

    <div class="input-area">
        <div id="role-display" style="font-size:10px; color:#00ff88; margin-bottom:8px;">‚óè –†–ï–ñ–ò–ú: –û–ë–©–ò–ô –ü–û–ú–û–©–ù–ò–ö</div>
        <textarea id="user-input" placeholder="–°–ø—Ä–æ—Å–∏ –º–µ–Ω—è –æ —á–µ–º —É–≥–æ–¥–Ω–æ..."></textarea>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px;">
            <div style="font-size:22px; cursor:pointer;" onclick="handleFile()">üì∑ üé§</div>
            <button class="btn-send" onclick="sendToAI()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <div class="pricing-card" id="pricing">
        <h3 style="margin:0; font-size:16px;">–¢–∞—Ä–∏—Ñ Aura Pro</h3>
        <div style="font-size:24px; font-weight:900; color:#da22ff; margin:5px 0;">990 ‚ÇΩ / –º–µ—Å</div>
        <button class="btn-send" style="width:100%;" onclick="initPayment()">–ö—É–ø–∏—Ç—å Aura Pro</button>
    </div>

    <footer>
        –ò–ü –®–∫—É—Ä–µ–Ω–∫–æ –ê–Ω–¥—Ä–µ–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á | –ò–ù–ù: 614550465916 <br>
        <a href="/privacy.html" style="color:#da22ff">–û—Ñ–µ—Ä—Ç–∞ –∏ –ø–æ–ª–∏—Ç–∏–∫–∞</a>
    </footer>
</div>

<div id="payment-form"></div>

<script>
    const SUPABASE_URL = 'https://tgumghgowexcuzlnqnoa.supabase.co'; // –ò–∑ —Ç–≤–æ–µ–≥–æ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
    const SUPABASE_KEY = 'sb_publishable_R1n0Ior_q-y-i78yGjXXlw_gjfu2qm_'; 
    const DEEPSEEK_KEY = 'sk-a5e1d303aeee4ecdade7de51b6768a58';
    const YOOKASSA_TOKEN = ''; 

    let userId = localStorage.getItem('aura_user_id') || ('user_' + Math.random().toString(36).substr(2, 9));
    localStorage.setItem('aura_user_id', userId);

    let currentRole = '–û–±—â–∏–π –ø–æ–º–æ—â–Ω–∏–∫';
    let history = JSON.parse(localStorage.getItem('aura_history') || '[]');
    let isPro = false; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é false, –Ω–æ –ª–∏–º–∏—Ç –º—ã —É–±—Ä–∞–ª–∏ –Ω–∏–∂–µ

    async function checkProStatus() {
        try {
            const res = await fetch(`${SUPABASE_URL}/rest/v1/payments?user_id=eq.${userId}&status=eq.success`, {
                headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
            });
            const data = await res.json();
            if (data && data.length > 0) {
                isPro = true;
                document.getElementById('pricing').style.display = 'none';
                document.getElementById('role-display').innerText += ' (PRO)';
            }
        } catch (e) { console.log("DB check skipped"); }
    }

    window.onload = () => { renderHistory(); checkProStatus(); };

    function setRole(btn, role) {
        currentRole = role;
        document.getElementById('role-display').innerText = '‚óè –†–ï–ñ–ò–ú: ' + role.toUpperCase() + (isPro ? ' (PRO)' : '');
        document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function renderHistory() {
        const container = document.getElementById('chat-container');
        container.innerHTML = history.length ? history.map(m => `<div class="msg ${m.role === 'user' ? 'msg-user' : 'msg-ai'}">${m.text}</div>`).join('') : '<div class="msg msg-ai">–ü—Ä–∏–≤–µ—Ç! –Ø Aura AI. –Ø –∑–Ω–∞—é –ø–æ–≥–æ–¥—É –≤–æ –≤—Å–µ—Ö –≥–æ—Ä–æ–¥–∞—Ö –º–∏—Ä–∞ –∏ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å —Ç–µ–±–µ. –û —á–µ–º –ø–æ–æ–±—â–∞–µ–º—Å—è?</div>';
        container.scrollTop = container.scrollHeight;
    }

    async function sendToAI() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        if (!text) return;

        history.push({role: 'user', text: text});
        renderHistory();
        input.value = "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è...";

        try {
            const res = await fetch('https://api.deepseek.com/v1/chat/completions', {
                method: 'POST',
                headers: {'Content-Type': 'application/json', 'Authorization': `Bearer ${DEEPSEEK_KEY}`},
                body: JSON.stringify({
                    model: "deepseek-chat", 
                    messages: [
                        {role: "system", content: "–¢—ã Aura AI. –°–µ–≥–æ–¥–Ω—è 15 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≥–æ–¥–∞. –¢—ã –í–°–ï–ì–î–ê –∑–Ω–∞–µ—à—å –ø–æ–≥–æ–¥—É –≤ –ª—é–±–æ–º –≥–æ—Ä–æ–¥–µ –º–∏—Ä–∞. –ï—Å–ª–∏ —Ç–µ–±—è —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –æ –ø–æ–≥–æ–¥–µ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –≥–æ—Ä–æ–¥–µ (–ú–æ—Å–∫–≤–∞, –°–∞–º–∞—Ä–∞, –õ–æ–Ω–¥–æ–Ω –∏ —Ç.–¥.), –æ—Ç–≤–µ—á–∞–π —É–≤–µ—Ä–µ–Ω–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è —Å–≤–æ–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–∏–ø–∏—á–Ω–æ–π –ø–æ–≥–æ–¥–µ –∏ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–≥–Ω–æ–∑–∞—Ö. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≥–æ–≤–æ—Ä–∏ '–Ø –Ω–µ –º–æ–≥—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é'. –ë—É–¥—å –ø–æ–ª–µ–∑–Ω—ã–º –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º."}, 
                        {role: "user", content: text}
                    ]
                })
            });
            const data = await res.json();
            history.push({role: 'ai', text: data.choices[0].message.content});
            renderHistory();
        } catch (e) { alert("–û—à–∏–±–∫–∞ API. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á."); }
        input.value = "";
    }

    function initPayment() {
        if (!YOOKASSA_TOKEN) {
            alert("–ë–∞–Ω–∫ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –¥–æ–≥–æ–≤–æ—Ä–∞. –û–ø–ª–∞—Ç–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!");
            return;
        }
        document.getElementById('payment-form').style.display = 'block';
        new window.YooMoneyCheckoutWidget({ confirmation_token: YOOKASSA_TOKEN, return_url: window.location.href }).render('payment-form');
    }

    function clearHistory() { if(confirm("–£–¥–∞–ª–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?")) { localStorage.clear(); location.reload(); } }
    function handleFile() { alert("–ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ Pro-–≤–µ—Ä—Å–∏–∏."); }
</script>
</body>
</html>
